<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl">
  <title data-ice="title">API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
<link data-ice="userStyle" rel="stylesheet" href="user/css/0-injected-style.css">
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/mikewesthad/phaser-navmesh-plugin" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/library/index.js~NavMeshPlugin.html">NavMeshPlugin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/library/nav-mesh.js~NavMesh.html">NavMesh</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><div data-ice="index" class="github-markdown"><h1 id="navigation-meshes-in-phaser">Navigation Meshes in Phaser</h1>
<p>In progress. A Phaser plugin for fast path-finding using navigation meshes.</p>
<p><a href="https://www.mikewesthad.com/phaser-navmesh/demo/"><img src="./doc-source/single-following-agent.gif" width="400"></a></p>
<p><a href="https://www.mikewesthad.com/phaser-navmesh/demo/">Interactive demo</a></p>
<p>The current path-finding plugins for Phaser use A<em> on the tiles in a tilemap. If you have a 50 x 50 tilemap, that&apos;s up to 2500 nodes in the A</em> graph.</p>
<p>This plugin uses navigation meshes to simplify that A<em> search. Instead of using tiles in a tilemap, it uses a mesh (currently quads) to describe the walkable areas within a map. This can lead to significant improvements in performance (e.g. &gt;100x times faster than Phaser&apos;s A</em> plugin over long distances).</p>
<p>The example map below (left) is a 30 x 30 map. Regular astar uses 780 nodes to represent the walkable areas. In contrast, the navmesh (right) uses 27 nodes (colored rectangles) to represent the walkable areas.</p>
<p><img src="./doc-source/combined.png" width="700"></p>
<h2 id="temporary-performance-comparison">Temporary Performance Comparison</h2>
<p>TODO: make this more readable and add interactive demo</p>
<p>Comparing this plugin against <a href="https://github.com/photonstorm/phaser-plugins">Phaser&apos;s A* plugin</a> and the JS lib <a href="https://github.com/prettymuchbryce/easystarjs">EasyStar.js</a>:</p>
<pre><code><code class="source-code prettyprint">Performance Comparison, 100000 iterations, 30x30 tilemap

Short paths (150 - 500 pixel length)

    Average time per iteration:
        AStart Plugin: 0.02470ms
        EasyStar Plugin: 0.02876ms
        NavMesh Plugin: 0.00575ms

    Comparison:
        NavMesh is 4.30x faster than Phaser AStar
        NavMesh is 5.00x faster than EasyStar

Long paths (600 pixels and greater length), average time per iteration:

    Average time per iteration:
        AStart Plugin: 1.38710ms
        EasyStar Plugin: 0.15977ms
        NavMesh Plugin: 0.00738ms

    Comparison:
        NavMesh is 187.95x faster than Phaser AStar
        NavMesh is 21.65x faster than EasyStar</code>
</code></pre><h2 id="usage">Usage</h2>
<pre><code class="lang-js"><code class="source-code prettyprint">// This snippet assumes you&apos;ve got your tilemap loaded in a variable called &quot;tilemap&quot;

// Register the plugin with Phaser
const navMeshPlugin = this.game.plugins.add(NavMeshPlugin);

// Load the navMesh from the tilemap object layer &quot;navmesh.&quot; The navMesh was created with 12.5 
// pixels of space around obstacles.
const navMesh = navMeshPlugin.buildMeshFromTiled(tilemap, &quot;navmesh&quot;, 12.5);

const p1 = new Phaser.Point(100, 400);
const p2 = new Phaser.Point(700, 200);
const path = navMeshPlugin.findPath(p1, p2);
// -&gt; path is now either an array of points, or null if no valid path could be found</code>
</code></pre>
<p>Visually debugging paths:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">navMesh.enableDebug(); // Create a graphics overlay on top of the screen
navMesh.debugClear(); // Clear the graphics
// Visualize the navmesh    
navMesh.debugDrawMesh({
    drawCentroid: true, drawBounds: false, drawNeighbors: true, drawPortals: true
});
// Visualize the path
const path = navMesh.findPath(follower.position, target, {
    drawPolyPath: true, drawFinalPath: true
});</code>
</code></pre>
<h2 id="todo">TODO</h2>
<ul>
<li>Documentation<ul>
<li>Describe the Tiled process. Adding an object layer, setting snapping, making sure vertices overlap...</li>
</ul>
</li>
<li>Allow non-square navmesh from Tiled - any convex shape</li>
<li>Custom export that attaches to Phaser game object or exports as a local</li>
<li>Reimplement the autotessalation version of the lib<ul>
<li>Try libtess in quad mode</li>
</ul>
</li>
<li>The astar heuristic &amp; cost functions need another pass. They don&apos;t always produce the shortest path. Implement incomplete funneling while building the astar path?</li>
<li>The navmesh assumes any polygon can reach any other polygon. This probably should be extended to put connected polygons into groups like patroljs.</li>
<li>There are probably optimization tricks to do when dealing with certain types of shapes. E.g. we are using axis-aligned boxes for the polygons and it is dead simple to calculate if a point is inside one of those...</li>
<li>Investigate <a href="http://www.david-gouveia.com/portfolio/pathfinding-on-a-2d-polygonal-map/">Points-of-Visibility</a> pathfinding to compare speed</li>
<li>Using ES6 is probably suboptimal for performance</li>
<li>Check against tilemap that is larger than the screen</li>
</ul>
<h2 id="references">References</h2>
<p>Sources while building this plugin:</p>
<ul>
<li>Inspired by <a href="https://github.com/nickjanssen/PatrolJS">PatrolJS</a>, an implementation of navmeshes for threejs</li>
<li>Navmesh path-finding algorithm explanations:<ul>
<li><a href="http://jceipek.com/Olin-Coding-Tutorials/pathing.html">Game Path Planning by Julian Ceipek</a></li>
<li><a href="http://digestingduck.blogspot.com/2010/03/simple-stupid-funnel-algorithm.html">Simple Stupid Funnel Algorithm</a></li>
</ul>
</li>
<li><a href="http://theory.stanford.edu/~amitp/GameProgramming/Heuristics.html">Advice on astar heuristics</a></li>
</ul>
</div>
</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.5.2)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
